-- H2 2.3.232; 
;              
CREATE USER IF NOT EXISTS "SA" SALT '60c8085f5c6b2aeb' HASH 'cbe9796d6548e7f61d928e460055bd8520ef002bc1d449e5c14d7a5e2d1591cc' ADMIN;          
DROP TABLE IF EXISTS "PUBLIC"."AJUSTE" CASCADE;
DROP TABLE IF EXISTS "PUBLIC"."AUTO" CASCADE;  
DROP TABLE IF EXISTS "PUBLIC"."CLIENTE" CASCADE;               
DROP TABLE IF EXISTS "PUBLIC"."COTIZACION" CASCADE;            
DROP TABLE IF EXISTS "PUBLIC"."COTIZACION_DETALLE" CASCADE;    
DROP TABLE IF EXISTS "PUBLIC"."EVIDENCIA" CASCADE;             
DROP TABLE IF EXISTS "PUBLIC"."MECANICO" CASCADE;              
DROP TABLE IF EXISTS "PUBLIC"."PIEZA" CASCADE; 
DROP TABLE IF EXISTS "PUBLIC"."PIEZA_AJUSTE" CASCADE;          
DROP TABLE IF EXISTS "PUBLIC"."PROVEEDOR" CASCADE;             
DROP TABLE IF EXISTS "PUBLIC"."ROL" CASCADE;   
DROP TABLE IF EXISTS "PUBLIC"."SEGUIMIENTO" CASCADE;           
DROP TABLE IF EXISTS "PUBLIC"."USUARIO" CASCADE;               
CREATE MEMORY TABLE "PUBLIC"."AJUSTE"(
    "AJUSTE_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "COSTO_ESTIMADO" FLOAT(53),
    "DESCRIPCION" CHARACTER VARYING(255)
);            
ALTER TABLE "PUBLIC"."AJUSTE" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_7" PRIMARY KEY("AJUSTE_ID"); 
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.AJUSTE;   
CREATE MEMORY TABLE "PUBLIC"."AUTO"(
    "AUTO_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ANIO" INTEGER NOT NULL,
    "MARCA" CHARACTER VARYING(15) NOT NULL,
    "MODELO" CHARACTER VARYING(15) NOT NULL,
    "PLACA" CHARACTER VARYING(15) NOT NULL,
    "CLIENTE_ID" BIGINT NOT NULL
);      
ALTER TABLE "PUBLIC"."AUTO" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_1" PRIMARY KEY("AUTO_ID");     
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.AUTO;     
CREATE MEMORY TABLE "PUBLIC"."CLIENTE"(
    "CLIENTE_ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "EMAIL" CHARACTER VARYING(40) NOT NULL,
    "NOMBRE" CHARACTER VARYING(50) NOT NULL,
    "TELEFONO" CHARACTER VARYING(10) NOT NULL,
    "USUARIO_ID" BIGINT
);    
ALTER TABLE "PUBLIC"."CLIENTE" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_5" PRIMARY KEY("CLIENTE_ID");               
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.CLIENTE;  
CREATE MEMORY TABLE "PUBLIC"."COTIZACION"(
    "COTIZACION_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "COSTO_TOTAL" FLOAT(53),
    "ESTATUS" CHARACTER VARYING(255),
    "FECHA" DATE,
    "AUTO_ID" INTEGER NOT NULL
);         
ALTER TABLE "PUBLIC"."COTIZACION" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_79" PRIMARY KEY("COTIZACION_ID");        
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.COTIZACION;               
CREATE MEMORY TABLE "PUBLIC"."COTIZACION_DETALLE"(
    "DETALLE_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ACEPTADO" BOOLEAN,
    "COSTO" FLOAT(53),
    "AJUSTE_ID" INTEGER NOT NULL,
    "COTIZACION_ID" INTEGER NOT NULL
);  
ALTER TABLE "PUBLIC"."COTIZACION_DETALLE" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_D" PRIMARY KEY("DETALLE_ID");    
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.COTIZACION_DETALLE;       
CREATE MEMORY TABLE "PUBLIC"."EVIDENCIA"(
    "EVIDENCIA_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "FECHA_SUBIDA" DATE,
    "TIPO" CHARACTER VARYING(255),
    "URL" CHARACTER VARYING(255),
    "COTIZACION_ID" INTEGER NOT NULL
);            
ALTER TABLE "PUBLIC"."EVIDENCIA" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_6" PRIMARY KEY("EVIDENCIA_ID");           
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.EVIDENCIA;
CREATE MEMORY TABLE "PUBLIC"."MECANICO"(
    "MECANICO_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ESPECIALIDAD" CHARACTER VARYING(255),
    "NOMBRE" CHARACTER VARYING(255),
    "USUARIO_ID" BIGINT
);         
ALTER TABLE "PUBLIC"."MECANICO" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_F" PRIMARY KEY("MECANICO_ID");             
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.MECANICO; 
CREATE MEMORY TABLE "PUBLIC"."PIEZA"(
    "PIEZA_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "COSTO_UNITARIO" FLOAT(53),
    "NOMBRE" CHARACTER VARYING(255),
    "PROVEEDOR_ID" INTEGER NOT NULL
);              
ALTER TABLE "PUBLIC"."PIEZA" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4" PRIMARY KEY("PIEZA_ID");   
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.PIEZA;    
CREATE MEMORY TABLE "PUBLIC"."PIEZA_AJUSTE"(
    "PIEZA_AJUSTE_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "CANTIDAD" INTEGER,
    "AJUSTE_ID" INTEGER NOT NULL,
    "PIEZA_ID" INTEGER NOT NULL
);               
ALTER TABLE "PUBLIC"."PIEZA_AJUSTE" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_49" PRIMARY KEY("PIEZA_AJUSTE_ID");    
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.PIEZA_AJUSTE;             
CREATE MEMORY TABLE "PUBLIC"."PROVEEDOR"(
    "PROVEEDOR_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "EMAIL" CHARACTER VARYING(255),
    "NOMBRE" CHARACTER VARYING(255),
    "TELEFONO" CHARACTER VARYING(255)
);
ALTER TABLE "PUBLIC"."PROVEEDOR" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_8" PRIMARY KEY("PROVEEDOR_ID");           
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.PROVEEDOR;
CREATE MEMORY TABLE "PUBLIC"."ROL"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 4) NOT NULL,
    "NOMBRE" CHARACTER VARYING(255)
);             
ALTER TABLE "PUBLIC"."ROL" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_13" PRIMARY KEY("ID");          
-- 3 +/- SELECT COUNT(*) FROM PUBLIC.ROL;      
INSERT INTO "PUBLIC"."ROL" VALUES
(1, 'ADMIN'),
(2, 'AGENTE'),
(3, 'MECANICO');
CREATE MEMORY TABLE "PUBLIC"."SEGUIMIENTO"(
    "SEGUIMIENTO_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ESTADO" CHARACTER VARYING(255),
    "FECHA_ACTUALIZACION" DATE,
    "DETALLE_ID" INTEGER NOT NULL,
    "MECANICO_ID" INTEGER NOT NULL
);
ALTER TABLE "PUBLIC"."SEGUIMIENTO" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_57" PRIMARY KEY("SEGUIMIENTO_ID");      
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.SEGUIMIENTO;              
CREATE MEMORY TABLE "PUBLIC"."USUARIO"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 4) NOT NULL,
    "APELLIDO" CHARACTER VARYING(255),
    "CONTRASENA" CHARACTER VARYING(255),
    "EMAIL" CHARACTER VARYING(255),
    "NOMBRE" CHARACTER VARYING(255),
    "ROL_ID" BIGINT
);
ALTER TABLE "PUBLIC"."USUARIO" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_2" PRIMARY KEY("ID");       
-- 3 +/- SELECT COUNT(*) FROM PUBLIC.USUARIO;  
INSERT INTO "PUBLIC"."USUARIO" VALUES
(1, 'Principal', 'admin123', 'admin@admin.com', 'Admin', 1),
(2, 'Ventas', 'agente123', 'agente@demo.com', 'Agente', 2),
(3, U&'Mec\00e1nico', 'mecanico123', 'mecanico@demo.com', 'Carlos', 3);         
ALTER TABLE "PUBLIC"."CLIENTE" ADD CONSTRAINT "PUBLIC"."FKC3U631OCXDRTM3CCPME0KJLMU" FOREIGN KEY("USUARIO_ID") REFERENCES "PUBLIC"."USUARIO"("ID") NOCHECK;    
ALTER TABLE "PUBLIC"."PIEZA_AJUSTE" ADD CONSTRAINT "PUBLIC"."FK50VO4WIW8OCUWJHEDFM2ASWPT" FOREIGN KEY("PIEZA_ID") REFERENCES "PUBLIC"."PIEZA"("PIEZA_ID") NOCHECK;             
ALTER TABLE "PUBLIC"."COTIZACION_DETALLE" ADD CONSTRAINT "PUBLIC"."FKL8038NFXTGQLWLYGRISF5JFI8" FOREIGN KEY("COTIZACION_ID") REFERENCES "PUBLIC"."COTIZACION"("COTIZACION_ID") NOCHECK;        
ALTER TABLE "PUBLIC"."MECANICO" ADD CONSTRAINT "PUBLIC"."FKCE9Y4BCMWOKP8GPJLSA8ANAMD" FOREIGN KEY("USUARIO_ID") REFERENCES "PUBLIC"."USUARIO"("ID") NOCHECK;   
ALTER TABLE "PUBLIC"."PIEZA" ADD CONSTRAINT "PUBLIC"."FKFYG23XX2JR857QP6DW8O119YY" FOREIGN KEY("PROVEEDOR_ID") REFERENCES "PUBLIC"."PROVEEDOR"("PROVEEDOR_ID") NOCHECK;        
ALTER TABLE "PUBLIC"."EVIDENCIA" ADD CONSTRAINT "PUBLIC"."FKLTQSGUBJH7XEHVE7RDGW32A5H" FOREIGN KEY("COTIZACION_ID") REFERENCES "PUBLIC"."COTIZACION"("COTIZACION_ID") NOCHECK; 
ALTER TABLE "PUBLIC"."AUTO" ADD CONSTRAINT "PUBLIC"."FKA6D5O203H8V5CEWM16TTFFW5T" FOREIGN KEY("CLIENTE_ID") REFERENCES "PUBLIC"."CLIENTE"("CLIENTE_ID") NOCHECK;               
ALTER TABLE "PUBLIC"."SEGUIMIENTO" ADD CONSTRAINT "PUBLIC"."FK2FC0VSSMI3XDQ3BOOXSY8P64" FOREIGN KEY("DETALLE_ID") REFERENCES "PUBLIC"."COTIZACION_DETALLE"("DETALLE_ID") NOCHECK;              
ALTER TABLE "PUBLIC"."USUARIO" ADD CONSTRAINT "PUBLIC"."FKSHKWJ12WG6VKM6IUWHVCFPCT8" FOREIGN KEY("ROL_ID") REFERENCES "PUBLIC"."ROL"("ID") NOCHECK;            
ALTER TABLE "PUBLIC"."PIEZA_AJUSTE" ADD CONSTRAINT "PUBLIC"."FK4OKN8EU2ROQ7LLMUP6FEDWYPG" FOREIGN KEY("AJUSTE_ID") REFERENCES "PUBLIC"."AJUSTE"("AJUSTE_ID") NOCHECK;          
ALTER TABLE "PUBLIC"."COTIZACION_DETALLE" ADD CONSTRAINT "PUBLIC"."FKNG8OC28WIJ02PP1XT3VULTI5V" FOREIGN KEY("AJUSTE_ID") REFERENCES "PUBLIC"."AJUSTE"("AJUSTE_ID") NOCHECK;    
ALTER TABLE "PUBLIC"."SEGUIMIENTO" ADD CONSTRAINT "PUBLIC"."FKRG7YP63LEAI2VJ7IQS27EWY95" FOREIGN KEY("MECANICO_ID") REFERENCES "PUBLIC"."MECANICO"("MECANICO_ID") NOCHECK;     
ALTER TABLE "PUBLIC"."COTIZACION" ADD CONSTRAINT "PUBLIC"."FK8WA7HK4L8S7LPTJW433R4EQ9I" FOREIGN KEY("AUTO_ID") REFERENCES "PUBLIC"."AUTO"("AUTO_ID") NOCHECK;  
